# BonusPay 收银台 V5.9.5 前端重构交付手册

**文档版本**: V1.0  
**适用对象**: 前端开发工程师  
**基准代码库**: `feat/V5.9.5` (GitHub)

---

## 1. 技术栈对齐 (Tech Stack Alignment)
本项目基于 AI 辅助设计的 **"Premium Stripe-Style"** 视觉规范构建。经过与贵团队现有技术栈（截图所示）的比对，融合策略如下：

| 模块 | 贵团队现有栈 | 本项目使用栈 | ⚠️ 融合与迁移策略 |
| :--- | :--- | :--- | :--- |
| **核心框架** | Vite + React | Vite + React | **完全一致**，无缝集成。 |
| **UI 框架** | Ant Design (AntD) | **Tailwind CSS (Pure)** | **重点**：为实现高定级动效和玻璃拟态，本项目脱离了 AntD 的组件样式，完全使用 Tailwind 原子类构建。**请务必保留 `tailwind.config.js` 中的自定义配置**，不要强行套用 AntD 组件，否则会丢失“呼吸感”视觉。 |
| **状态管理** | - | React Hooks (`useCheckoutState`) | 本项目封装了一个纯 Hooks 状态机，可直接复制使用，或对接你们的 Redux/Zustand。 |
| **路由** | react-router-dom | (单页模拟) | 本 Demo 为单组件多状态 (`State-Driven UI`)，容易嵌入你们现有的路由页面中。 |
| **Web3 交互** | Wagmi + Viem | Wagmi V2 | **完全一致**。本项目已验证 Wagmi V2 的连接/断开/签名逻辑，请复用 `src/hooks/useCheckoutState.ts` 中的逻辑复活代码。 |
| **网络请求** | Axios | (`setTimeout` 模拟) | **开发点**：请将源码中的 `setTimeout` 模拟延时替换为你们真实的 Axios 接口调用。 |
| **动效引擎** | - | **Framer Motion** | **新增**：用于处理复杂的页面切换和元素布局动画（如 `layoutId` 共享元素过渡），需安装 `framer-motion`。 |
| **图标库** | - | **Lucide React** | **新增**：轻量级 SVG 图标库，比 AntD Icons 更符合现代审美。 |

---

## 2. 核心模块与架构 (Core Architecture)

开发人员在接手 GitHub 代码时，请重点关注以下目录结构：

```bash
src/
├── components/          # UI 组件库 (原子化拆分)
│   ├── WalletGrid.tsx   # 钱包选择网格 (含呼吸动效核心逻辑)
│   ├── ChainSelector.tsx# 链选择组件 (已集成 Wagmi 余额读取)
│   ├── ActionConsole.tsx# 签名/二次确认控制台
│   ├── MobileShell.tsx  # 移动端适配外壳 (核心布局容器)
│   └── IconLibrary.tsx  # 支付渠道 SVG 资产库 (ETH, BSC, Binance 等)
├── hooks/
│   └── useCheckoutState.ts # 🚨 [核心大脑] 状态机逻辑
└── wagmi.ts             # Web3 配置文件 (已修复连接器冲突)
```

### 关键逻辑点移交：
1.  **useCheckoutState.ts**: 这是收银台的“大脑”。它管理了从 `SELECTION` (选钱包) -> `PROCESSING` (连接中) -> `SUCCESS` (结果) 的所有跳转。
    *   *注意*：这里面包含了防止 MetaMask 重复连接的“双重重置”逻辑 (`disconnectAsync` before `connectAsync`)，请务必保留。
2.  **WalletGrid.tsx**: 包含了 framer-motion 的 `AnimatePresence` 和 `layoutId`。这是实现“点击图标后图标放大并呼吸”效果的关键，**请勿轻易更改 DOM 结构**，否则动画会失效。

---

## 3. UI 适配与动效参数 (UI & Animation)

### 3.1 响应式适配策略 (Mobile First)
本项目采用了 **"Mobile Shell"** 架构：
*   **核心内容区**：始终保持移动端宽幅 (Max-width: 375px ~ 420px)，模拟原生 App 体验。
*   **桌面端适配**：在桌面浏览器上，内容区会自动居中，背景增加模糊光斑 (`animate-blob`) 以填充空白。
*   **开发参数**：
    *   字体系统：`text-[10px]` (Caption), `text-xs` (Body), `text-xl` (Title)。
    *   容器圆角：`rounded-3xl` (大圆角卡片风格)。

### 3.2 动效库集成
请将 GitHub 仓库中 `tailwind.config.js` 的 `theme.extend` 部分完整复制到你们的项目中。关键动画包括：
*   `animate-breathe`: 用于 Loading 时的呼吸光晕。
*   `animate-fade-in`: 页面切换时的柔和浮现。
*   `backdrop-blur-xl`: iOS 风格的高级毛玻璃效果。

---

## 4. GitHub 迭代追踪指南 (Workflow for Future Iterations)

当产品经理（我）使用 AI 生成新版本后，开发团队应如何高效同步？

### 4.1 提交规范 (Commit Semantics)
我在 GitHub 上的提交遵循以下 Semantic Commit 规范，方便开发筛选：
*   `feat: ...` : 包含新的 UI 布局或新页面（重点关注）。
*   `fix: ...` : 修复逻辑 Bug（如 Wagmi 连接问题，直接 cherry-pick 代码）。
*   `style: ...` : 纯样式调整（Tailwind 类名变更）。

### 4.2 变更定位技巧
1.  **查找 "Audit" 标记**：我在关键逻辑代码中埋入了 `console.log('[Audit] ...')`。在合并代码时，搜索 `[Audit]` 关键字即可快速定位核心业务逻辑修改位置。
2.  **使用 GitHub Comparison**：
    *   每次 AI update 后，请在 GitHub 上使用 **Compare** 功能（Tag 对比）。
    *   重点查看 `src/hooks/` 和 `src/components/` 下的文件变更。
    *   忽略 `src/index.css` 以外的自动生成文件。

### 4.3 建议的分光协作流
建议在你们的主仓库中建立一个 `design-reference` 分支：
1.  将我的 GitHub 仓库作为 `remote` 添加。
2.  定期 `git pull` 我的更新到 `design-reference` 分支。
3.  开发人员使用 IDE (VSCode) 的对比工具，将 UI 代码“摘录”到 `dev` 分支，替换真实的 API 数据。

---

## 5. 常见问题 (FAQ for Devs)

**Q: 为什么不用 Ant Design 的 Button？**
A: AntD 的 Button 自带样式权重过高，难以实现设计稿中的“全宽、大圆角、带阴影、点击缩放”的高级质感。现在的 `button` 标签配合 Tailwind 类名（`active:scale-95`）性能更好且还原度 100%。

**Q: 为什么本地运行 Wagmi 报错？**
A: 请检查 `App.tsx` 是否包裹了 `<WagmiProvider>` 和 `<QueryClientProvider>`。如果缺少 TanStack Query 的 Provider，Hooks 会一直处于 Pending 状态。

**Q: 怎么对接真实后端 API？**
A: 在 `useCheckoutState.ts` 中搜索 `setTimeout`。所有模拟延时的地方（如 `submitOrder`），都是你们插入 `axios.post('/api/pay/...')` 的最佳锚点。

---

**Generated by Antigravity AI Assistant**
