# 收银台界面重构 - 1/23

---



### 一、 核心逻辑图谱：从“支付方式”转向“钱包连接”

我们将交互流分为四个阶段，完全贴合你提出的“感知 - 编排 - 体验一致 - 兜底”闭环。

### 1. 阶段一：原子起点与环境感知 (The Sense & Select)

**你的要求：** *前端感知用户终端环境，提供适配的钱包选项。*

- **设计策略：EIP-6963 (Multi-Injected Provider Discovery) 范式应用**
    
    传统的收银台是硬编码的列表（如：支付宝、微信）。我们的收银台是**动态**的。
    
    - **感知层（Sensor）：** 用户打开收银台的毫秒级瞬间，前端脚本（JS SDK）扫描当前浏览器或系统的环境：
        - *桌面端：* 检测 Window 对象中注入了哪些插件（MetaMask, Phantom, OKX Wallet 等）。
        - *移动端：* 检测是否安装了特定 App（通过 Universal Links 探测），或者是否处于某个 DApp 浏览器内部（如在 TP 钱包的内置浏览器中打开）。
    - **展示层（UI Orchestration）：**
        - **优先展示（Detected）：** 将**已检测到**的钱包前置，并打上“Installed”或“Ready”的轻量化标签。
        - **折叠/推荐（Suggested）：** 对于未安装但支持的钱包，放入二级菜单，或根据当前商户支持的链（如 Solana 链商户）推荐特定钱包。

### 2. 阶段二：最优路径编排 (The Optimal Path)

**你的要求：** *提供从商户页面到用户钱包的“最短跳转路径”。*

这是我们收银台的核心“反重力”引擎。我们需要根据设备类型，自动从后台配置的策略库中调取最优连接方式：

- **场景 A：移动端 (Mobile Web / App) -> 移动端钱包**
    - **编排逻辑：Deep Link (App-to-App) 直连。**
    - **交互设计：**
        - 用户点击“MetaMask”图标。
        - **不展示二维码**（这是移动端的阻力）。
        - 直接唤起系统级弹窗：“是否允许打开 MetaMask？”。
        - *Antigravity 细节：* 在点击瞬间，收银台 UI 变为“等待钱包响应”状态，背景虚化，中心出现钱包 Logo 的呼吸动效，暗示连接正在建立。
- **场景 B：桌面端 (Desktop Web) -> 插件钱包 (Extension)**
    - **编排逻辑：Injected Provider 唤醒。**
    - **交互设计：**
        - 用户点击图标，浏览器右上角插件直接弹窗请求连接。
        - 收银台页面同步显示指引箭头指向浏览器右上角（引导用户视线）。
- **场景 C：跨设备/环境不支持 (Desktop -> Mobile Wallet)**
    - **编排逻辑：WalletConnect 协议 (QR Code)。**
    - **交互设计：**
        - 只有在无法直连时，才展示二维码。
        - *优化：* 二维码应包含具体的 Chain ID 和支付金额信息，扫码即弹窗签名，减少手机端操作步骤。

### 3. 阶段三：原生体验一致性 (Native Consistency)

**你的要求：** *预期体验与钱包内支付体验保持一致。*

- **设计原则：不越权，只透传。**
    
    收银台在这里必须“隐身”。我们不能自作聪明地搞一套复杂的确认页面，而是应该把**Call Data（交易数据）**精准地传给钱包。
    
- **交互细节：**
    - 当唤起 MetaMask 时，用户看到的是他最熟悉的 MetaMask 签名页（Gas 费、总金额、目标地址）。
    - **收银台侧配合：** 收银台页面应进入“监听模式”。我们不应该让用户在收银台手动点“我已支付”，而是通过链上监听或 RPC 回调，自动在收银台页面显示“支付成功”。

### 4. 阶段四：逆向兜底与状态同步 (The Safety Net)

**你的要求：** *逆向退回收银台的选择的兜底。*

这是一个极易被忽视但决定转化率的关键点。用户可能因为 Gas 费太高取消支付，或者钱包 App 崩溃。

- **场景：用户在钱包内点击“取消”或“拒绝签名”**
    - **逻辑：** 钱包通过 Deep Link Callback 或 Promise Reject 返回错误码给收银台。
    - **UI 反馈：** 收银台不应直接报错（红色警告），而是**温柔地复位**。
        - *文案：* “取消了本次签名？没关系，您可以重新选择钱包或调整支付方式。”
        - *状态：* 页面瞬间切回【阶段一：钱包选择器】，保持之前的选项高亮，减少用户重新寻找的认知负担。
- **场景：应用切换中断（用户切回浏览器，但未支付）**
    - **逻辑：** 页面检测到 visibilitychange 事件（用户切回来了），查询链上状态发现未支付。
    - **UI 反馈：** 弹出一个轻量级 Action Sheet：“支付遇到问题了吗？”
        - 选项 A：遇到困难，查看帮助。
        - 选项 B：已完成支付（手动触发查询）。
        - 选项 C：更换钱包。

---

### 二、 交互原型描述 (First Draft Description)

基于上述逻辑，我为你构思了一个收银台界面的大致框架：

**页面标题：** Check out / 支付收银台

**区域 1：环境感知区 (Smart Dock)**

- *（动态区域，高度自适应）*
- 标题：“检测到已安装/可用的钱包”
- 样式：大图标卡片，横向排列。
- 逻辑：
    - 如果 JS 检测到 window.ethereum.isMetaMask 为 true，则展示 MetaMask 卡片，并标记 "推荐"。
    - 如果 JS 检测到 Hardware Wallet 连接，展示 Ledger 图标。

**区域 2：其他连接方式 (Manual Connect)**

- 标题：“连接其他钱包”
- 样式：折叠列表或网格。
- 逻辑：WalletConnect 通用入口，支持扫码。

—

# 2016 - 数币收银台支付方式编排优化

**核心关键词：web3钱包双核识别、开放选择、动态兜底**

# **1. 思考背景**

1. 基于当前数币支付的使用习惯， 数币的主要依托与其冷热钱包绑定在一起。 
2. 所以开始思考： 数币收银台的支付的起点无论线上还是线下应该让用户先选择钱包。
3.  基于钱包的选择，如果是线上的收银台- 基于其前端框架对于用户终端的感知和主动获得硬件环境感知的权限，收银台的前端应该可以帮助用户或者提供给用户其产品范围颗粒度以内的开放式用这个钱包可以进行这个场景适配的支付方式的主动选择。
4. 可以将最优路径帮助用户做使用连接和使用前的交互提示。 
5. 对于用户来说，其点选钱包以后，则预期的用这个钱包的支付流的体验应与这个钱包或者这类钱包内的支付体验保持一致。 比如，metamask，作为收银台用户支付选择，则 如何最优转入用户熟悉的metamask内进行支付是第一要素。于此同时，基于用户使用的终端，提供给用户从商户页面到用户选择的钱包的最短跳转路径，则是 未来做收银台编排里的重点。
6. 逆向退回收银台的选择的兜底 - 继续使用直接转账支付方式兜底。 

# **2. 界面层级结构**

## 2.1  正向 界面层级

**A. 头部创建订单区** 

```jsx
+-------------------------------------------------------+
|  [商户Logo]  商户名称展示                            |
|                                                       |
|           $ 20.00                                     |
|                                                       |
+-------------------------------------------------------+
```

**B. 中层容器：智能筛选与钱包网格**

```jsx
帮助用户在“交易所”和“Web3钱包”之间快速分流
+-------------------------------------------------------+
|  [ 🔍 搜索 ]   (● 全部)   ( 🏦 交易所 )   ( 🦊 Web3 )    |
+-------------------------------------------------------+

```

**C. 钱包原子网格**

```jsx
+-------------------------------------------------------+
|  检测到已安装 (Detected)                                |
|  +-------+    +-------+                               |
|  | [🦊]  |    | [🟡]  |                               |
|  | Meta  |    | Binan |                               |
|  | Mask  |    | ce    |                               |
|  +-------+    +-------+                               |
|                                                       |
|  所有钱包 (All Wallets)                                 |
|  +-------+    +-------+    +-------+    +-------+     |
|  | [🔵]  |    | [⚫️]  |    | [🟣]  |    | [⚪️]  |     |
|  | Coin  |    | OKX   |    | Phan  |    | Trust |     |
|  | base  |    | Wall  |    | tom   |    |       |     |
|  +-------+    +-------+    +-------+    +-------+     |
|                                                       |
|  +-------+    +-------+                               |
|  | [Led] |    | ...   |                               |
|  | ger   |    | More  |                               |
|  +-------+    +-------+                               |
+-------------------------------------------------------+
```

**D. 交互层** 

**双核选择面板 (Dual-Core Panel)**

*此处不显示 Gas Fee（根据你的要求），只做路径选择。*

```jsx
+-------------------------------------------------------+
|  < 返回       [🟡] Binance                            |
|                                                       |
|  选择支付方式：                                         |
|                                                       |
|  +-------------------------------------------------+  |
|  |  (Radio ◉)  ⚡️ Binance Pay [推荐]               |  |
|  |  [ 使用交易所现货余额支付，秒级确认 ]                |  |
|  +-------------------------------------------------+  |
|                                                       |
|  +-------------------------------------------------+  |
|  |  (Radio ○)  ⛓️ Web3 钱包连接                      |  |
|  |  [ 连接链上钱包进行转账 ]                          |  |
|  +-------------------------------------------------+  |
|                                                       |
|               [ 确认支付 $20.00 ]                      |
|                                                       |
+-------------------------------------------------------+
```

**E. 底层容器：兜底保障**

*在主卡片的最底部，保持低调但可见。* 

```jsx
+-------------------------------------------------------+
|                                                       |
|      无法连接钱包？ [使用地址直接转账 >]                  |
|                                                       |
|             Powered by Bonuspay                 |
+-------------------------------------------------------+
```

## **2.2  逆向流程**

核心逻辑是：**“报错即切换”**。当系统感知到异常（失败/超时/拒绝），不要弹窗让用户去“确认错误”，而是直接把界面变身，展示出**“B计划（直转）”**，同时保留**“重选（回首页）”**的退路。

**触发场景：**

1. 用户在 MetaMask 弹窗里点了 "Reject"。
2. 唤起 App 超过 8 秒无响应（超时）。
3. Binance Pay API 返回错误。
4. 打开钱包有异常报错等。 

```jsx
+-------------------------------------------------------+
|  < 返回首页 (Back to List)                            |
|                                                       |
|  [⚠️ 警示色条] 连接未完成或已取消                       |
|                                                       |
|  但您依然可以直接转账支付：                             |
|  (System automatically shows Direct Transfer)         |
|                                                       |
|  +-------------------------------------------------+  |
|  |           [  QR Code (动态二维码)  ]             |  |
|  |                                                 |  |
|  |     [开关] ◉ 标准模式  ○ 纯地址模式 (兼容性)      |  |
|  +-------------------------------------------------+  |
|                                                       |
|  +-------------------------------------------------+  |
|  |  金额: 20.00 USDC             [复制]             |  |
|  +-------------------------------------------------+  |
|  +-------------------------------------------------+  |
|  |  地址: 0x7A2...8f3c           [复制]             |  |
|  |  [标签: ETH 主网 - 请务必核对]                    |  |
|  +-------------------------------------------------+  |
|                                                       |
|   ((📡)) 正在监听链上交易... (无需手动确认)             |
|                                                       |
|  +-------------------------------------------------+  |
|  |  [ 按钮 ]  还是想用其他钱包支付？                    |  |
|  |         返回钱包列表 (Choose Wallet)              |  |
|  +-------------------------------------------------+  |
+-------------------------------------------------------+
```

## 3. 文字描述

原子定义的升级：从“单质原子”到“同位素原子”

- **普通原子 (Standard Atom)：** 如 MetaMask, Trust。只有一条路：链上支付。
- **混合原子 (Hybrid Atom)：** 如 Binance, OKX。包含两种属性：[Custodial Pay] 和 [Web3 Connect]。

---

用户点击收银台上的“Binance”图标时，不再直接跳转，而是**展开（Expand）**该原子的能力面板。

- **交互动作：** 点击图标 -> 卡片向下展开 -> 出现分流选项。
- **开放式选择 (The Open Choice)：**
    - **选项 A：[快捷支付 / Binance Pay]**
        - *Tag:* “免 Gas · 秒到账 · 现货余额”
        - *视觉权重：* **Primary (主按钮)**。这是符合反重力设计的最轻路径。
    - **选项 B：[Web3 钱包支付]**
        - *Tag:* “链上转账 · 自管资产”
        - *视觉权重：* Secondary (次级按钮/幽灵按钮)。
    - **选项 C：[直接转账]** (入口展示极低)
        - *位置：* 作为一个纯文本链接或小字，置于卡片最底部：“使用地址直接转账 >”

### 路径分发与执行

根据用户的选择，收银台启动不同的引擎：

- **路径 A (Custodial)：API 握手**
    - 调用交易所的支付 SDK (Checkout API)。
    - **体验：** 唤起 App -> 仅需确认金额 -> 输入支付密码 (交易所内) -> 回调成功。
- **路径 B (Non-Custodial)：协议连接**
    - 走 EIP-6963 / WalletConnect 流程。
    - **体验：** 唤起 App -> 签名授权 -> 广播上链。

---

### 3. 逆向退回逻辑：漏斗式兜底 (The Funnel Fallback)

这是你强调的重点。当上述 A 或 B 路径出现 API 报错、网络超时或服务不可用时，**直接转账 (Direct Transfer)** 将从“不起眼的角落”自动升格为“舞台主角”。

**场景模拟：用户选择了 [Binance Pay] 托管支付**

1. **正向尝试：** 系统尝试调用 Binance Pay API 唤起 App。
2. **异常发生：**
    - *情况 1：* API 返回 503 Service Unavailable。
    - *情况 2：* 用户 App 版本过低不支持 Pay 接口。
    - *情况 3：* 唤起后用户未操作，直接杀进程返回。
3. **自动降级 (Auto-Downgrade)：**
    - 收银台捕获错误信号。
    - **UI 变化：** 展开的卡片不收起，而是直接**“翻转”**或**“滑入”**到【直接转账控制台】。
    - **文案引导（安抚）：**
        - *“快捷支付连接中断，已为您切换至**专用转账通道**。您依然可以使用 Binance App 的‘扫一扫’完成支付。”*
4. **最终代收 (The Ultimate Responsibility)：**
    - 展示：临时收款地址 + 二维码 (带协议切换开关)。
    - **核心逻辑：** 无论前面对接了多少高大上的 API，**只要给用户一个地址，他一定能把钱转过来。** 这就是无需 API 的最终确定性。

---